
### **Misskey Bot 要件定義書**

#### **1. Botの目的**
指定されたYouTubeチャンネルに投稿された最新のショート動画（YouTube Shorts）の内容を、Gemini APIを用いて分析・解説し、Misskeyに投稿する。主なターゲット視聴者が英語圏である動画について、日本人フォロワーが内容を理解しやすくなるような補助的な情報を提供することを目的とする。

#### **2. 対象チャンネル**
- **チャンネル名:** Siren Satellite
- **チャンネルURL:** `https://www.youtube.com/@SirenSatellite_en`

#### **3. 主な機能要件**
Botは以下のステップで動作する。

1.  **最新ショート動画の取得**
    *   環境変数で指定されたYouTubeチャンネルから、最新の「ショート動画」を1件特定し、その動画URLを取得する。
    *   YOUTUBE APIを使うのは面倒なので、スクレイピングを推奨
    *   一度処理した動画を再度投稿しないように、処理済みの動画IDを記録・管理する仕組みを設ける。（例: ファイルや簡単なデータベースに保存）

2.  **Gemini APIによる解説文の生成**
    *   取得した**YouTube動画のURL**を、後述するプロンプトと共に直接Gemini API（Gemini 1.5 Proなど、動画解析に対応したモデル）に送信する。
    *   Geminiは動画の内容（映像に埋め込まれたテキスト、音声など）を直接解釈し、指示されたフォーマットに従って解説文を生成する。
    *   ※動画のダウンロードやOCR処理は不要。

3.  **Misskeyへの投稿**
    *   以下の「4. 投稿内容のフォーマット」に従って、Misskeyにノートを投稿する。

#### **4. 投稿内容のフォーマット**
Misskeyに投稿されるノートは、以下の形式とする。

```
[ここにYouTubeショート動画のURLが入る]

---
[以下、Geminiが生成した内容]

**[動画タイトル]**

**📝 逐語訳**
00:00 [英語テキスト1]
[日本語訳1]

00:02 [英語テキスト2]
[日本語訳2]

...

**💡 文化的な背景の解説**
[この動画の内容を日本人が理解しやすくするための補足解説]
```

#### **5. Geminiへの指示（プロンプト）**
Gemini APIに解説文を生成させるために使用するプロンプトの骨子。

---
**プロンプト例:**

あなたは、英語のYouTube動画を日本の視聴者向けに解説する専門家です。以下のYouTubeショート動画を解析し、指定のフォーマットで解説文を作成してください。

**# 解析対象の動画**
[ここにYouTubeショート動画のURLを挿入]

**# 作成フォーマット**
```
**[動画タイトル]**

**📝 逐語訳**
[動画内で話されている、または映像として表示されている英語テキストを、タイムスタンプ付きで全て書き出し、その下に自然な日本語訳を併記してください。]
例:
00:01 WA means JAPAN!
00:01 和は日本という意味！

**💡 文化的な背景の解説**
[この動画で語られている内容や使用されているスラング、ミームなどが、英語圏の文化に詳しくない日本人には理解が難しい場合があります。そのような点について、文化的背景や元ネタを優しく補足解説してください。もし、特に補足することがない場合は、「特にありません。」と記述してください。]
```

**# 注意事項**
- 逐語訳は、動画内のテキストを可能な限り正確に、出現する時間（タイムスタンプ）と共に書き出してください。
- 解説は、元の動画の意図を尊重し、中立的かつ客観的に記述してください。
- あなた自身の意見や感想は含めないでください。
---

#### **6. 必要な設定項目（環境変数）**
このBotを動作させるために、以下の情報を環境変数として設定できるようにする。

- `MISSKEY_URL`: 投稿先のMisskeyインスタンスのURL (例: `https://misskey.io`)
- `MISSKEY_TOKEN`: Botアカウントのアクセストークン
- `YOUTUBE_API_KEY`: Google Cloudで取得したYouTube Data API v3のAPIキー
- `YOUTUBE_CHANNEL_ID`: 対象となるYouTubeチャンネルのID
- `GEMINI_API_KEY`: Google AI Studio等で取得したGeminiのAPIキー

#### **7. 技術的な提案・その他考慮事項**
- **開発言語:** Python
- **ライブラリ候補:**
    - Misskey投稿: `misskey.py`
    - Gemini API連携: `google-generativeai`
- **エラーハンドリング:** YouTube、Gemini、Misskeyの各APIとの通信でエラーが発生した場合を想定し、ログ出力やリトライ処理を実装することが望ましい。
- **実行頻度:** systemctlのtimerで実行するので、サンプルのファイルを作ってくれると嬉しい